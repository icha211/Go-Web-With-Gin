# RESTful API with Go and Gin

This project is a RESTful API built with Go and the Gin framework to manage a music album collection with JWT authentication.

## Features

### Authentication
- **POST /register** - Register a new user account
- **POST /login** - Login with existing credentials
- **GET /profile** - Get the authenticated user's profile

### Albums (Protected Routes)
- **GET /albums** - Get all albums (requires authentication)
- **GET /albums/:id** - Get a specific album by ID (requires authentication)
- **POST /albums** - Add a new album (requires authentication)

## Data Structure

### User
- `id` (uint) - Unique identifier (auto-generated)
- `email` (string) - User email address (unique)
- `password` (string) - Hashed password (not returned in responses)
- `name` (string) - User name

### Album
- `id` (uint) - Unique identifier (auto-generated by GORM)
- `title` (string) - Album title
- `artist` (string) - Artist name
- `price` (float64) - Album price

## Installation and Setup

1. Make sure you have Go installed (version 1.16 or newer)

2. Clone or download this project

3. Install dependencies:
```bash
go get .
```

4. Create a `.env` file (optional):
```env
JWT_SECRET=your-secret-jwt-key-change-in-production
```

5. Run the server:
```bash
go run .
```

The server will start on `localhost:8082`

## Usage

### Authentication

#### Register a new user
```bash
curl -X POST http://localhost:8082/register \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123", "name": "John Doe"}'
```

#### Login
```bash
curl -X POST http://localhost:8082/login \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password123"}'
```

Both endpoints return a JWT token that must be included in subsequent requests.

### Albums (Protected Routes)

#### Get all albums
```bash
curl http://localhost:8082/albums \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### Get a specific album
```bash
curl http://localhost:8082/albums/1 \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### Add a new album
```bash
curl -X POST http://localhost:8082/albums \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{"title": "Kind of Blue", "artist": "Miles Davis", "price": 45.99}'
```

Note: The `id` field is auto-generated by GORM and should not be included in the request body.

#### Get user profile
```bash
curl http://localhost:8082/profile \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## Response Examples

### POST /register
```json
{
  "user": {
    "id": 1,
    "email": "user@example.com",
    "name": "John Doe"
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### POST /login
```json
{
  "user": {
    "id": 1,
    "email": "user@example.com",
    "name": "John Doe"
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### GET /albums
```json
[
  {
    "id": 1,
    "title": "Blue Train",
    "artist": "John Coltrane",
    "price": 56.99
  },
  {
    "id": 2,
    "title": "Jeru",
    "artist": "Gerry Mulligan",
    "price": 17.99
  }
]
```

### GET /albums/1
```json
{
  "id": 1,
  "title": "Blue Train",
  "artist": "John Coltrane",
  "price": 56.99
}
```

### POST /albums
```json
{
  "id": 4,
  "title": "Kind of Blue",
  "artist": "Miles Davis",
  "price": 45.99
}
```

## Technology Stack

- **Go** - Programming language
- **Gin** - Web framework
- **GORM** - ORM for database operations
- **SQLite** - Database (albums.db)
- **JWT** - JSON Web Tokens for authentication
- **bcrypt** - Password hashing

## Project Structure

```
.
├── controllers/          # Request handlers
│   ├── albumsController.go
│   └── authController.go
├── models/              # Data models
│   ├── album.go
│   └── user.go
├── middleware/          # Middleware functions
│   └── authMiddleware.go
├── initializers/       # Initialization code
│   ├── database.go
│   └── loadEnv.go
├── utils/              # Utility functions
│   └── jwt.go
├── Test_request_gin/   # Bruno API tests
├── main.go             # Application entry point
└── albums.db           # SQLite database file
```

## Notes

- Data is stored in a SQLite database (`albums.db`)
- The database is automatically migrated on startup
- JWT tokens are valid for 24 hours
- All album routes require authentication via Bearer token
- Passwords are hashed using bcrypt before storage
- For production use, ensure `JWT_SECRET` is set to a secure random string
